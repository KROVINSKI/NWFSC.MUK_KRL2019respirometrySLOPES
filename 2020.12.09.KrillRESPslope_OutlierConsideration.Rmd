
---
title: "Respirometry Trails for Summer Krill 2019"
output:
 html_document:
    df_print: paged
    code_folding: hide
    toc: TRUE
    toc_depth: 4
    toc_float: true
    theme: journal
    highlight: zenburn
    smart: false
editor_options: 
  chunk_output_type: inline
---


Hello World

Author: OA Lab, NWFSC
Title: Respirometry Trails for Summer Krill 2019- Trying to Adapt to make the Package ‘FishResp’ Package work
Date: December 2020


# Version Check
```{r 0.1 Version Check , echo=FALSE, results=FALSE, message=FALSE, warning=FALSE}
#*********************************
## Version Check
#********************************* 
R.version

```


# Libraries
```{r 0.0 Libraries , echo=FALSE, results=FALSE, message=FALSE, warning=FALSE}
#*********************************
##Libraries
#********************************* 
library(stringr)
library(tidyverse)
library(plyr)
library(nlme)
library(tidyr)
library(dbplyr)
library(purrr)
library(wql)
library(lubridate)
library(tibbletime)
library(arsenal)
library(compareDF)
#for graphing
library(ggplot2)
library(ggfortify)
library(stringr)
library(nlme)
library(RColorBrewer)
#statistical analysis
library(gdata)
library(rsq)
library(doBy)
#Rnotebooks 
library(gridExtra)
library(kableExtra)

```


 
# 1.) Setting Working Directory
```{r 1.) Setting Working Directory }
#*********************************
## 1.) Setting Working Directory
#*********************************

#set working directory to the correct folder
setwd("/Users/katherinerovinski/GIT/NWFSC.MUK_KRL2019respirometrySLOPES")
```



# 2.) Creating the Dataframe
```{r 2.) Creating the Dataframe }

#*********************************
## 2.) Creating the intial Dataframe, dRESP
#*********************************

## Method 1 - 1 file for the four trials
#get all the files in the defined working directory that are in csv format  
dRESP <- read.csv(file = "KRILL_Resp_alltrials.csv", stringsAsFactors = FALSE)
dim(dRESP)

#write.csv(dRESP, file = "2020.11.30_presenseSENSORONLY.alltrials.data.csv", row.names = FALSE)
#|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |


# dRESPanimal represents just the animal, vial, MOATs, etc.  
dRESPanimal <- read.csv(file = "RespirometryTrials_all.Animal.Info.csv") 
dim(dRESPanimal)

#write.csv(dRESPanimal, file = "2020.11.30_krillanimaldata.csv", row.names = FALSE)
#|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |


#dRESPmsr represents the measurements made by the presense optical device for Dissolved Oxygen 
dRESPmsr <- merge(dRESP, dRESPanimal, by="SensorName")

#write.csv(dRESPmsr, file = "2020.12.01_respirometrymeasurements.csv", row.names = FALSE)
#|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |


# dRESP$MOATS <- factor(dRESP$MOATS)
# Checking the names of the different levels
# levels(dRESP$MOATS)


# dRESPmsr <- dRESPmsr %>% filter(!MOATS %in% c("3", "4", "5", "11")) %>%
#   filter(Treatment %in% c("CUR", "CHG", "TMP")) 
# 
# 
# dRESPmsr <- dRESPmsr %>% filter(!MOATS %in% c("3", "4", "5", "11")) %>%
#   filter(Treatment %in% c("CUR", "CHG", "TMP", "n/a")) 


```




# 3.) Creating dateTime objects 
```{r 3.) Creating dateTime objects }

#*********************************
## 3.) Creating dateTime objects  
#*********************************

dRESPmsr$dateTime <- ""
dRESPmsr$dateTime <- as.POSIXct(paste(dRESPmsr$Date,
                                      dRESPmsr$Time), "%d-%B-%y %H:%M:%S", tz="UTC")

# QA check
dim(dRESPmsr)

dRESPmsr$Time <- as.POSIXct(dRESPmsr$dateTime, format="%H:%M:%S")


```



# 4.) Cleaning up observations
```{r 4.) Cleaning up observations }
#*********************************
## 4.) Cleaning up observations  
#********************************

#Removing items with faulty sensor names
dRESPmsr <- subset(dRESPmsr, SensorName != "")

dRESPmsr$SensorName <- str_trim(dRESPmsr$SensorName, side = c("both"))
dRESPmsr$SensorName <- factor(dRESPmsr$SensorName)
dim(dRESPmsr)

dRESPmsr <- subset(dRESPmsr, Value != "---")

# Confirming proper number of krill 
# 76, 4x19 propoer number of animals under observation 
unique(dRESPmsr$SensorName)
UniqueSensorNames <- levels(dRESPmsr$SensorName)
write.table(UniqueSensorNames, file = "2020.11.30DRESPmsr_UniqueSensorNames.csv")
kable(UniqueSensorNames)

```



#5.) Creating Trial ID & Krill ID
```{r 5.) Creating Trial ID & Krill ID}
#*********************************
## 5.) Creating a Krill ID with Trial in name    
#*********************************

## First Trial began at 2019-10-28 14:25:01
## First Trial ended at 2019-10-28 16:37:29

## Second Trial began at 2019-10-28 18:55:21
## Second Trial ended at 2019-10-28 21:16:45

## Third Trial began at 2019-10-29 14:06:21
## Third Trial ended at 2019-10-29 16:18:36

## Fourth Trial began at 2019-10-29 17:20:21
## Fourth Trial ended at 2019-10-29 19:32:01


dRESPmsr$TrialID <- ""
dRESPmsr <- dRESPmsr %>% mutate(TrialID=case_when(
  
## First Trial began at 2019-10-28 14:25:01
## First Trial ended at 2019-10-28 16:37:29
  
  ((Time >= as.POSIXct("2019-10-28 14:25:00", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 16:37:30", tz = "UTC"))) ~ "Trial01",

  
## Second Trial began at 2019-10-28 18:55:21
## Second Trial ended at 2019-10-28 21:16:45  
  
  ((Time >= as.POSIXct("2019-10-28 18:55:20", tz = "UTC")) 
   & (Time <= as.POSIXct("2019-10-28 21:16:50", tz = "UTC"))) ~ "Trial02",


## Third Trial began at 2019-10-29 14:06:21
## Third Trial ended at 2019-10-29 16:18:36


  ((Time >= as.POSIXct("2019-10-29 14:06:18", tz = "UTC")) 
   & (Time <= as.POSIXct("2019-10-29 16:18:40", tz = "UTC"))) ~ "Trial03",

## Fourth Trial began at 2019-10-29 17:20:21
## Fourth Trial ended at 2019-10-29 19:32:01

  
  ((Time >= as.POSIXct("2019-10-29 17:20:18", tz = "UTC")) 
   & (Time <= as.POSIXct("2019-10-29 19:40:01", tz = "UTC"))) ~ "Trial04",

  TRUE ~"other"
)) 

#|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |

## new value 
## dRESPmsr$KrillID

dRESPmsr$KrillID <- ""

dRESPmsr$KrillID <- paste(dRESPmsr$TrialID, "_", dRESPmsr$SensorName, sep="")
#View(dRESPmsr)

#|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |



```

## 5.a Creating Round Variable
```{r 5.a Creating Round Variable}

#*********************************
## 5.) Creating the Round Variable to best identify the acclimination period
#*********************************
# The acclimination period was detailed as the first 10minutes 
# Eight Rounds of Respirometry were conducted 
# Creating the rounds of respirometry to later advise outlier elimination, 
#                                             data filtering consideration
# 
dRESPmsr$RESPRound <- ""
dRESPmsr <- dRESPmsr %>% mutate(RESPRound=case_when(

# ---TRIAL ONE, ROUND---ONE--- #  
## First Trial,   Round 1 on 2019-10-28 began 14:25:01
## First Trial,   Round 1 on 2019-10-28 ended 14:44:00
  ((Time >= as.POSIXct("2019-10-28 14:25:00", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 14:44:00", tz = "UTC"))) ~ "T1Round1",  

# ---TRIAL ONE, ROUND---TWO--- #
## First Trial,   Round 2 on 2019-10-28 began 14:44:01
## First Trial,   Round 2 on 2019-10-28 ended 14:58:59
  ((Time >= as.POSIXct("2019-10-28 14:44:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 14:58:59", tz = "UTC"))) ~ "T1Round2",  

# ---TRIAL ONE, ROUND---THREE--- #
## First Trial,   Round 3 on 2019-10-28 began 14:59:00
## First Trial,   Round 3 on 2019-10-28 ended 15:14:00
  ((Time >= as.POSIXct("2019-10-28 14:59:00", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 15:14:00", tz = "UTC"))) ~ "T1Round3",   

# ---TRIAL ONE, ROUND---FOUR--- #
## First Trial,   Round 4 on 2019-10-28 began 15:14:01
## First Trial,   Round 4 on 2019-10-28 ended 15:29:00
  ((Time >= as.POSIXct("2019-10-28 15:14:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 15:29:00", tz = "UTC"))) ~ "T1Round4",  
 
# ---TRIAL ONE, ROUND---FIVE--- #
## First Trial,   Round 5 on 2019-10-28 began 15:29:01
## First Trial,   Round 5 on 2019-10-28 ended 15:44:00
  ((Time >= as.POSIXct("2019-10-28 15:29:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 15:44:00", tz = "UTC"))) ~ "T1Round5",  

# ---TRIAL ONE, ROUND---SIX--- #
## First Trial,   Round 6 on 2019-10-28 began 15:44:01
## First Trial,   Round 6 on 2019-10-28 ended 15:59:00
  ((Time >= as.POSIXct("2019-10-28 15:44:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 15:59:00", tz = "UTC"))) ~ "T1Round6", 
 
# ---TRIAL ONE, ROUND---SEVEN--- #
## First Trial,   Round 7 on 2019-10-28 began 15:59:01
## First Trial,   Round 7 on 2019-10-28 ended 16:14:00
  ((Time >= as.POSIXct("2019-10-28 15:59:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 16:14:00", tz = "UTC"))) ~ "T1Round7", 
 
# ---TRIAL ONE, ROUND---EIGHT--- #
## First Trial,   Round 8 on 2019-10-28 began 16:14:01
## First Trial,   Round 8 on 2019-10-28 ended 16:29:59
  ((Time >= as.POSIXct("2019-10-28 16:14:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 16:29:59", tz = "UTC"))) ~ "T1Round8",

####

# ---TRIAL TWO, ROUND---ONE--- #  
## Second Trial,   Round 1 on 2019-10-28 began 18:50:01
## Second Trial,   Round 1 on 2019-10-28 ended 19:05:00
  ((Time >= as.POSIXct("2019-10-28 18:50:00", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 19:05:00", tz = "UTC"))) ~ "T2Round1",  

# ---TRIAL TWO, ROUND---TWO--- #
## Second Trial,   Round 2 on 2019-10-28 began 19:05:01
## Second Trial,   Round 2 on 2019-10-28 ended 19:20:00
  ((Time >= as.POSIXct("2019-10-28 19:05:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 19:20:00", tz = "UTC"))) ~ "T2Round2",  

# ---TRIAL TWO, ROUND---THREE--- #
## Second Trial,   Round 3 on 2019-10-28 began 19:20:01
## Second Trial,   Round 3 on 2019-10-28 ended 19:35:00
  ((Time >= as.POSIXct("2019-10-28 19:20:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 19:35:00", tz = "UTC"))) ~ "T2Round3",   

# ---TRIAL TWO, ROUND---FOUR--- #
## Second Trial,   Round 4 on 2019-10-28 began 19:35:01
## Second Trial,   Round 4 on 2019-10-28 ended 19:50:00
  ((Time >= as.POSIXct("2019-10-28 19:35:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 19:50:00", tz = "UTC"))) ~ "T2Round4",  
 
# ---TRIAL TWO, ROUND---FIVE--- #
## Second Trial,   Round 5 on 2019-10-28 began 19:50:01
## Second Trial,   Round 5 on 2019-10-28 ended 20:05:00
  ((Time >= as.POSIXct("2019-10-28 19:50:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 20:05:00", tz = "UTC"))) ~ "T2Round5",  

# ---TRIAL TWO, ROUND---SIX--- #
## Second Trial,   Round 6 on 2019-10-28 began 20:05:01
## Second Trial,   Round 6 on 2019-10-28 ended 20:20:00
  ((Time >= as.POSIXct("2019-10-28 20:05:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 20:20:00", tz = "UTC"))) ~ "T2Round6", 
 
# ---TRIAL TWO, ROUND---SEVEN--- #
## Second Trial,   Round 7 on 2019-10-28 began 20:20:01
## Second Trial,   Round 7 on 2019-10-28 ended 20:35:00
  ((Time >= as.POSIXct("2019-10-28 20:20:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 20:35:00", tz = "UTC"))) ~ "T2Round7", 
 
# ---TRIAL TWO, ROUND---EIGHT--- #
## Second Trial,   Round 8 on 2019-10-28 began 20:35:01
## Second Trial,   Round 8 on 2019-10-28 ended 20:50:59
  ((Time >= as.POSIXct("2019-10-28 20:35:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-28 20:50:59", tz = "UTC"))) ~ "T2Round8",


###


# ---TRIAL THREE, ROUND---ONE--- #  
## Second Trial,   Round 1 on 2019-10-29 began 14:00:01
## Second Trial,   Round 1 on 2019-10-29 ended 14:10:00
  ((Time >= as.POSIXct("2019-10-29 14:00:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-29 14:10:00", tz = "UTC"))) ~ "T3Round1",  

# ---TRIAL THREE, ROUND---TWO--- #
## Second Trial,   Round 2 on 2019-10-29 began 14:10:01
## Second Trial,   Round 2 on 2019-10-29 ended 14:25:00
  ((Time >= as.POSIXct("2019-10-29 14:10:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-29 14:25:00", tz = "UTC"))) ~ "T3Round2",  

# ---TRIAL THREE, ROUND---THREE--- #
## Second Trial,   Round 3 on 2019-10-29 began 14:25:01
## Second Trial,   Round 3 on 2019-10-29 ended 14:40:00
  ((Time >= as.POSIXct("2019-10-29 14:25:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-29 14:40:00", tz = "UTC"))) ~ "T3Round3",   

# ---TRIAL THREE, ROUND---FOUR--- #
## Second Trial,   Round 4 on 2019-10-29 began 14:40:01
## Second Trial,   Round 4 on 2019-10-29 ended 14:55:00
  ((Time >= as.POSIXct("2019-10-29 14:40:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-29 14:55:00", tz = "UTC"))) ~ "T3Round4",  
 
# ---TRIAL THREE, ROUND---FIVE--- #
## Second Trial,   Round 5 on 2019-10-29 began 14:55:01
## Second Trial,   Round 5 on 2019-10-29 ended 15:10:00
  ((Time >= as.POSIXct("2019-10-29 14:55:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-29 15:10:00", tz = "UTC"))) ~ "T3Round5",  

# ---TRIAL THREE, ROUND---SIX--- #
## Second Trial,   Round 6 on 2019-10-29 began 15:10:01
## Second Trial,   Round 6 on 2019-10-29 ended 15:25:00
  ((Time >= as.POSIXct("2019-10-29 15:10:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-29 15:25:00", tz = "UTC"))) ~ "T3Round6", 
 
# ---TRIAL THREE, ROUND---SEVEN--- #
## Second Trial,   Round 7 on 2019-10-29 began 15:25:01
## Second Trial,   Round 7 on 2019-10-29 ended 15:40:00
  ((Time >= as.POSIXct("2019-10-29 15:25:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-29 15:40:00", tz = "UTC"))) ~ "T3Round7", 
 
# ---TRIAL THREE, ROUND---EIGHT--- #
## Second Trial,   Round 8 on 2019-10-29 began 15:40:01
## Second Trial,   Round 8 on 2019-10-29 ended 15:55:59
  ((Time >= as.POSIXct("2019-10-29 15:40:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-29 15:55:59", tz = "UTC"))) ~ "T3Round8",


###


# ---TRIAL FOUR, ROUND---ONE--- #  
## Second Trial,   Round 1 on 2019-10-29 began 17:23:01
## Second Trial,   Round 1 on 2019-10-29 ended 17:38:00
  ((Time >= as.POSIXct("2019-10-29 17:23:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-29 17:38:00", tz = "UTC"))) ~ "T4Round1",  

# ---TRIAL FOUR, ROUND---TWO--- #
## Second Trial,   Round 2 on 2019-10-29 began 17:38:01
## Second Trial,   Round 2 on 2019-10-29 ended 17:53:00
  ((Time >= as.POSIXct("2019-10-29 17:38:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-29 17:53:00", tz = "UTC"))) ~ "T4Round2",  

# ---TRIAL FOUR, ROUND---THREE--- #
## Second Trial,   Round 3 on 2019-10-29 began 17:53:01
## Second Trial,   Round 3 on 2019-10-29 ended 18:08:00
  ((Time >= as.POSIXct("2019-10-29 17:53:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-29 18:08:00", tz = "UTC"))) ~ "T4Round3",   

# ---TRIAL FOUR, ROUND---FOUR--- #
## Second Trial,   Round 4 on 2019-10-29 began 18:08:01
## Second Trial,   Round 4 on 2019-10-29 ended 18:23:00
  ((Time >= as.POSIXct("2019-10-29 18:08:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-29 18:23:00", tz = "UTC"))) ~ "T4Round4",  
 
# ---TRIAL FOUR, ROUND---FIVE--- #
## Second Trial,   Round 5 on 2019-10-29 began 18:23:01
## Second Trial,   Round 5 on 2019-10-29 ended 18:38:00
  ((Time >= as.POSIXct("2019-10-29 18:23:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-29 18:38:00", tz = "UTC"))) ~ "T4Round5",  

# ---TRIAL FOUR, ROUND---SIX--- #
## Second Trial,   Round 6 on 2019-10-29 began 18:38:01
## Second Trial,   Round 6 on 2019-10-29 ended 18:53:00
  ((Time >= as.POSIXct("2019-10-29 18:38:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-29 18:53:00", tz = "UTC"))) ~ "T4Round6", 
 
# ---TRIAL FOUR, ROUND---SEVEN--- #
## Second Trial,   Round 7 on 2019-10-29 began 18:53:01
## Second Trial,   Round 7 on 2019-10-29 ended 19:08:00
  ((Time >= as.POSIXct("2019-10-29 18:53:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-29 19:08:00", tz = "UTC"))) ~ "T4Round7", 
 
# ---TRIAL FOUR, ROUND---EIGHT--- #
## Second Trial,   Round 8 on 2019-10-29 began 19:08:01
## Second Trial,   Round 8 on 2019-10-29 ended 19:23:59
  ((Time >= as.POSIXct("2019-10-29 19:08:01", tz = "UTC")) 
   & (Time < as.POSIXct("2019-10-29 19:23:59", tz = "UTC"))) ~ "T4Round8",

  TRUE ~"other"
)) 


as.factor(dRESPmsr$RESPRound)
levels(dRESPmsr$RESPRound)

```



## 5.b Grouping by KrillID and then by Time
```{r}
#Grouping by KrillID
dRESPmsr <- dRESPmsr %>% group_by(KrillID)
#Order Chronologically
# dRESPmsr <- dRESPmsr %>% group_by(Time)
# dRESPmsr <- dRESPmsr [order(as.Date(dRESPmsr$Time, format="%d-%B-%y %H:%M:%S", tz="UTC")),]
# #Will print tibble
# dRESPmsr [order(as.Date(dRESPmsr$Time, format="%d-%B-%y %H:%M:%S", tz="UTC")),]
# dRESPmsr <- dRESPmsr %>% arrange(dRESPmsr(Time), .by_group = TRUE)
# dRESPmsr <- dRESPmsr %>%
#   mutate(date = as.Date(dRESPmsr$Time, "%d-%B-%y %H:%M:%S")) %>%
#   arrange(date)
# dRESPmsr %>%
#   mutate(date = as.Date(dRESPmsr$Time, "%d-%B-%y %H:%M:%S")) %>%
#   arrange(date)
dRESPmsr <- dRESPmsr[order(dRESPmsr$Time),]
dRESPmsr[order(dRESPmsr$Time),]
#Organize by Round


```




# 6.) DO Corrections
```{r 6.) DO trial 3 correction applied to all rounds}
#*********************************
## 6.) DO trial 3 correction applied to all rounds   
#*********************************

# New values to correct the DO values for the temperature in Trial 3 in the dataframe dRESPmsr

dRESPmsr$percentDOassumpt <- ""
dRESPmsr$assumedSatDOmg <- ""
dRESPmsr$percentDO <- ""
dRESPmsr$obseveredSatDOmg <- ""
dRESPmsr$actualDOmg <- ""

dRESPmsr$percentDOassumpt <- as.numeric(dRESPmsr$percentDOassumpt)
dRESPmsr$assumedSatDOmg <- as.numeric(dRESPmsr$assumedSatDOmg)
dRESPmsr$percentDO <- as.numeric(dRESPmsr$percentDO)
dRESPmsr$obseveredSatDOmg <- as.numeric(dRESPmsr$obseveredSatDOmg)
dRESPmsr$actualDOmg <- as.numeric(dRESPmsr$actualDOmg)
#|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |

#Correct Temperature
dRESPmsr$CorTemp <- 11

#Salinity Constant
dRESPmsr$SalinityConstant <- 30.3
#|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |

# Numeric Corrections to DO value
dRESPmsr$Value <- as.numeric(dRESPmsr$Value)

dRESPmsr$assumedSatDOmg <- oxySol(dRESPmsr$CorTemp, 
                                  dRESPmsr$SalinityConstant)

dRESPmsr$percentDOassumpt <- dRESPmsr$Value / dRESPmsr$assumedSatDOmg

dRESPmsr$obseveredSatDOmg <- oxySol(dRESPmsr$CorTemp, dRESPmsr$SalinityConstant)

dRESPmsr$percentDO <- dRESPmsr$Value / dRESPmsr$assumedSatDOmg

dRESPmsr$actualDOmg <- dRESPmsr$percentDO * dRESPmsr$obseveredSatDOmg


#|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |


vialVol <- 0.02806 #liters (rather than 28.06mL)

oxygen <- vialVol * dRESPmsr$actualDOmg   
##mg per liter is the units for Oxygen per vial

dRESPmsr$oxygen <- oxygen




```




# 6.a) DO table & DO correction Plot Check
```{r 6.a) DO table & DO correction Plot Check  }
#*********************************
## 6.a) DO table & DO correction Plot Check  
#*********************************

# write.table(dRESPmsr, file = "2020.11.06.dRESPmeasurements", sep=";", 
#             row.names = TRUE)
# 
# dRESPmsr <-subset(dRESPmsr, actualDOmg != "---")
# dRESPmsr$Time <- as.POSIXct(dRESPmsr$Time, format="%H:%M:%S")
ggplot(dRESPmsr, aes(x = Time, y = actualDOmg, colour = SensorName)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  facet_wrap(~TrialID) +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  theme_bw()

```


# 7.) Initial Dataframe dRESPmsr Plots, 80% DO, Oxygen Per Vial, Actual DOmg/L

## Trial01 Loading Map
![Trial01 Loading Map](/Users/katherinerovinski/GIT/NWFSC.MUK_KRL2019respirometrySLOPES/Trial01of2(2019.10.28)respirometry.png)


### 7.1a) PLotting Percent DO filtering Trial 1
```{r 7.1a) PLotting Percent DO filtering Trial 1}

T1dRESPmsr <- filter(dRESPmsr, TrialID == "Trial01")

levels(T1dRESPmsr$Treatment)

ggplot(T1dRESPmsr, aes(x = Time, y = percentDO, colour = SensorName)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial01 Percent DO") +
  facet_wrap(~ Treatment) + 
  geom_hline(yintercept = c(.8), colour = "red") +
  theme_bw()


```


### 7.1b) Trial 1 Vial Oxygen over Time
```{r 7.1b) Trial 1 Vial Oxygen over Time}

ggplot(T1dRESPmsr, aes(x = Time, y = oxygen, colour = KrillID)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial01 Vial Oxygen over Time") +
  facet_wrap(~ Treatment) + 
  theme_bw()

```

### 7.1c) Trial01 Vial Oxygen over Time Organized by Round (1 of 8)
Depending on ordering there were animals that went all the way to ten rounds 
Likely that we will only consider rounds 01 through 08 due to 80% curve.

Goal in plotting animals by round is to see if there is a "temporal panic profile".
Do we need to wait long for an acclimation period? 
This will have implications on future respirometry protocols if a chase period is introduced.


```{r 7.1c) Trial01 Vial Oxygen over Time Organized by Round (1 of 8)}

ggplot(T1dRESPmsr, aes(x = Time, y = oxygen, colour = RESPRound)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial01 Vial Oxygen over Time Organized by Round (1 of 8)") +
  facet_wrap(~ Treatment) + 
  theme_bw()


```



## Trial02 Loading Map
![Trial02 Loading Map](/Users/katherinerovinski/GIT/NWFSC.MUK_KRL2019respirometrySLOPES/Trial02of2(2019.10.28)respirometry.png)

### 7.2a) PLotting Percent DO filtering Trial 2
```{r 7.2) PLotting Percent DO filtering Trial 2}

# T2dRESPmsr <- filter(dRESPmsr, TrialID == "Trial02") %>%
# c("CUR", "CHG", "TMP", "n/a"))

T2dRESPmsr <- filter(dRESPmsr, TrialID == "Trial02")
T2dRESPmsr <- T2dRESPmsr %>% filter(Treatment %in% c("CUR", "CHG", "TMP", "n/a"))


ggplot(T2dRESPmsr, aes(x = Time, y = percentDO, colour = SensorName)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial02 Percent DO- AmbientTreatmentRemoved") +
  facet_wrap(~ Treatment) + 
   geom_hline(yintercept = c(.8), colour = "red") +
  theme_bw()


```


### 7.2a) Trial 2 Vial Oxygen over Time
```{r 7.2a) Trial 2 Vial Oxygen over Time}

ggplot(T2dRESPmsr, aes(x = Time, y = oxygen, colour = KrillID)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial02 Vial Oxygen over Time") +
  facet_wrap(~ Treatment) + 
  theme_bw()

```


### 7.2c) Trial02 Vial Oxygen over Time Organized by Round (1 of 8)

Second Trial,   Round 1 on 2019-10-28 began 18:50:01
Second Trial,   Round 8 on 2019-10-28 ended 20:50:59

What is going on with you Trial 02

```{r 7.2c) Trial02 Vial Oxygen over Time Organized by Round (1 of 8)}

ggplot(T2dRESPmsr, aes(x = Time, y = oxygen, colour = RESPRound)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial02 Vial Oxygen over Time Organized by Round (1 of 8)") +
  facet_wrap(~ Treatment) + 
  theme_bw()


```

## Trial03 Loading Map
![Trial03 Loading Map](/Users/katherinerovinski/GIT/NWFSC.MUK_KRL2019respirometrySLOPES/Trial01of2(2019.10.29)respirometry.png)


### 7.3) PLotting Percent DO filtering Trial 3
```{r 7.3) PLotting Percent DO filtering Trial 3}

T3dRESPmsr <- filter(dRESPmsr, TrialID == "Trial03")


ggplot(T3dRESPmsr, aes(x = Time, y = percentDO, colour = SensorName)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial03 Percent DO") +
  facet_wrap(~ Treatment) + 
   geom_hline(yintercept = c(.8), colour = "red") +
  theme_bw()


```



### 7.3a) Trial 3 Vial Oxygen over Time
```{r 7.3a) Trial 3 Vial Oxygen over Time}

ggplot(T3dRESPmsr, aes(x = Time, y = oxygen, colour = KrillID)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial03 Vial Oxygen over Time") +
  facet_wrap(~ Treatment) + 
  theme_bw()

```


### 7.3c) Trial03 Vial Oxygen over Time Organized by Round (1 of 8)
```{r 7.3c) Trial03 Vial Oxygen over Time Organized by Round (1 of 8)}

ggplot(T3dRESPmsr, aes(x = Time, y = oxygen, colour = RESPRound)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial03 Vial Oxygen over Time Organized by Round (1 of 8)") +
  facet_wrap(~ Treatment) + 
  theme_bw()


```



## Trial04 Loading Map
![Trial04 Loading Map](/Users/katherinerovinski/GIT/NWFSC.MUK_KRL2019respirometrySLOPES/Trial02of2(2019.10.29)respirometry.png)

### 7.4) PLotting Percent DO filtering Trial 4
```{r 7.4) PLotting Percent DO filtering Trial 4}

T4dRESPmsr <- filter(dRESPmsr, TrialID == "Trial04")


ggplot(T4dRESPmsr, aes(x = Time, y = percentDO, colour = SensorName)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial04 Percent DO") +
  facet_wrap(~ Treatment) + 
   geom_hline(yintercept = c(.8), colour = "red") +
  theme_bw()


```



### 7.4a) Trial 4 Vial Oxygen over Time
```{r 7.4a) Trial 4 Vial Oxygen over Time}

ggplot(T4dRESPmsr, aes(x = Time, y = oxygen, colour = KrillID)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial04 Vial Oxygen over Time") +
  facet_wrap(~ Treatment) + 
  theme_bw()

```


### 7.4c) Trial04 Vial Oxygen over Time Organized by Round (1 of 8)
Acclimination period snuck in from the start
Second Trial,   Round 1 on 2019-10-29 began 17:23:01
Second Trial,   Round 8 on 2019-10-29 ended 19:23:59

```{r 7.4c) Trial04 Vial Oxygen over Time Organized by Round (1 of 8)}

ggplot(T4dRESPmsr, aes(x = Time, y = oxygen, colour = RESPRound)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial04 Vial Oxygen over Time Organized by Round (1 of 8)") +
  facet_wrap(~ Treatment) + 
  theme_bw()


```



# 8.) Analysis, Respirometry - Creating the Slope Function 
```{r 8.) Analysis, Respirometry - Creating the Slope Function}
#*********************************
## 8.) Analysis, Respirometry - Creating the Slope Function  
#*********************************  

#nmol/vial; conversion for L to ml and umol to nmol cancels
#slope funcion of 2 vectors
slope <- function(y,x){
  return(lm(y~x, na.action = na.omit)$coefficients[2])
}
  
#|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |
dRESPmsr$delta_t <- as.numeric(dRESPmsr$delta_t)

cSlopes <- by(dRESPmsr, dRESPmsr$KrillID, function(x){ slope(x$oxygen, x$delta_t)})

#|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |

#creating a data frame instead of a list 
ds <- as.data.frame(sapply(cSlopes, I))
#having row names be a variable in a column to be able to pull it out for later merging 
ds$TrialID<- row.names(ds)



```



# 9.) Merging ds and dRESPmsr 
```{r 9.) Merging ds and dRESPmsr}
#add column to dslopes thats KrillID
#View(dref)
ds$KrillID <- row.names(ds)
#View(dslopes)
dtotal <- merge(dRESPmsr, ds, by = "KrillID")
#View(dtotal)

```



# 10.) Krill ID as a factor & Grouping by Krill ID
```{r 10.) Krill ID as a factor & Grouping by Krill ID}
dtotal$KrillID <- factor(dtotal$KrillID)
nlevels(dtotal$KrillID)


```



# 11.) Analysis, Respirometry - Creating Slope Functions & Linear Models  
```{r 11.) Analysis, Respirometry - Creating Slope Functions & Linear Models  }
#*********************************
## 11.1) Creating the ds dataframe
#*********************************
# #get slopes and r^2 values from dtotal 

dSlopes <- data.frame(KrillID = levels(dtotal$KrillID))
# dSlopes$slope <- NA
# dSlopes$rsq <- NA

for(i in 1:length(dSlopes$KrillID)){
   m <- lm(oxygen ~ delta_t,
                         dtotal[dtotal$KrillID == dSlopes$KrillID[i],],
                         na.action=na.omit)
  dSlopes$slope[i] <- m$coefficients[2]
  dSlopes$rsq[i] <- summary(m)$r.squared
}

#|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |

krillslopes <- merge(dtotal, dSlopes, by="KrillID")

dSlopes$SensorName <- ""

dSlopes <- dSlopes %>% group_by(KrillID)
dRESPanimal <- dRESPanimal %>% group_by(SensorName)

#|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |

dSlopes$KrillID <- as.character(dSlopes$KrillID)
dSlopes$SensorName <- dRESPanimal$SensorName
dSlopes$TrialID <- dRESPanimal$TrialID
dSlopes$MOATS <- dRESPanimal$MOATS
dSlopes$Treatment<- dRESPanimal$Treatment
dSlopes$LoadingLocation<- dRESPanimal$LoadingLocation
dSlopes$VialNum<- dRESPanimal$GlassVialNumber
dSlopes$TelsonLength<- dRESPanimal$TelsonLength..mm.
dSlopes$WetWeight<- dRESPanimal$Size

# #|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |

```



# 12.) Investigating Outliers
The dtotal dataframe is broken up into four different dataframes based on Trial ID.
These dataframes will be further filtered to remove the Ambient Treatment.
Some rounds of respirometry featured a greater number ambient treatment animals and should account for the differences in number of observations between dataframes.

## 12.1 Investigating Outliers by Trial
```{r 12.1 Investigating Outliers by Trial}

# Filtering down dtotal to Trial 01, 02, 03 & 04 with only included treatments
# Trial 01
dtotal$TrialID <- dtotal$TrialID.x 
T1dTotal <- filter(dtotal, TrialID == "Trial01")
T1dTotal <- T1dTotal %>% filter(Treatment %in% c("CUR", "CHG", "TMP", "n/a"))
dim(T1dTotal)
#[1] 932  76

# Trial 02
T2dTotal <- filter(dtotal, TrialID == "Trial02")
T2dTotal <- T2dTotal %>% filter(Treatment %in% c("CUR", "CHG", "TMP", "n/a"))
dim(T2dTotal)
# [1] 568  76

# Trial 03
T3dTotal <- filter(dtotal, TrialID == "Trial03")
T3dTotal <- T3dTotal %>% filter(Treatment %in% c("CUR", "CHG", "TMP", "n/a"))
dim(T3dTotal)
# [1] 926  76

# Trial 04
T4dTotal <- filter(dtotal, TrialID == "Trial04")
T4dTotal <- subset(T4dTotal, Treatment != "AMB")
#T4dTotal <- T4dTotal %>% filter(Treatment %in% c("CUR", "CHG", "TMP", "NA"))


dim(T4dTotal)
# [1] 349  76

```


**Question**: Trial 04 does seem small- [1] 349  76 | were we just so more efficent at using the PRESENS probe than we were with trail 02 on day 01?

**Question** I'm not missing blanks am I?
T4dTotal <- filter(dtotal, TrialID == "Trial04")
T4dTotal <- T4dTotal %>% filter(Treatment %in% c("CUR", "CHG", "TMP", "NA"))

###12.1a Investigating Outliers by Trial- timeseries plots showing the four distinct dataframes
```{r 12.1a Investigating Outliers by Trial- timeseries plots}

par(mfrow = c(2,2))
plot(T1dTotal$delta_t, T1dTotal$oxygen)
plot(T2dTotal$delta_t, T2dTotal$oxygen)
plot(T3dTotal$delta_t, T3dTotal$oxygen)
plot(T4dTotal$delta_t, T4dTotal$oxygen)


```


### 12.2 Example of loop and function writting Kate is trying to for each krill
### 12.2a) take 1 df at a time 
```{r 12.2a take the first dataframe}

# read the 1 dataframe per trial
# observe it learn it's secrets
dim(T1dTotal)
kable(T1dTotal)
```


### 12.2b) Use the unique tool to get names for each krill
```{r 12.2b) Use the unique tool to get names for each krill}

unique(T1dTotal$KrillID)
qT1dTotal <- unique(T1dTotal$KrillID)
kable(qT1dTotal)

```



### 12.2c) Create a linear model object for 1 krill 
```{r 12.2c) Create a linear model object for 1 krill}

df_KrillR11 <- T1dTotal[T1dTotal$KrillID == "Trial01_KrilLR11",]
lm_KrillR11 <- lm(df_KrillR11$oxygen ~ df_KrillR11$delta_t)

```



### 12.2d) Use the fortify function to get the residuals and cook.sd for each observation
```{r 12.2d) Use the fortify function to get the residuals and cook.sd for each observation}

#lm_KrillR11 <- lm(df_KrillR11$oxygen ~ df_KrillR11$delta_t)
#lm_KrillR11 is the referenced linear model object
df.lm.KrillR11 <- fortify(lm_KrillR11, df_KrillR11)
kable(df.lm.KrillR11)

```



### 12.2e) Indentify which observations have a cooksd score above 4/n
n is the whole number of observations on that krill in the vial
```{r 12.2e) Indentify which observations have a cooksd score above 4/n}

#df.lm.KrillR11sat$.cooksd <- df.lm.KrillR11[df.lm.KrillR11$.cooksd <= 4/(length(df.lm.KrillR11$KrillID)), ]

```



### 12.2f) Use one dataframe to sort another
```{r 12.2f) Use one dataframe to sort another}

df.lm.KrillR11$.cooksd <= 4/(length(df.lm.KrillR11$KrillID))


```


# 13.) Krill Sparkle Function
```{r 13.) Krill Sparkle Function}

KRILLLmSparkle <- function(dfToFilter) {
  # Determine the unique list of Krill IDs
  krillIds <- unique(dfToFilter$KrillID)
  
  # Create an empty list to hold the filtered dataframes we'll eventually combine
  filteredData <- list()
  filteredDataIndex <- 1
  
  # Loop over each Krill ID
  for (krillId in krillIds) {
    #print(krillId)
    # Split the dataframe by the Krill ID
    filteredKrillIdData <- dfToFilter[dfToFilter$KrillID == krillId,]
    #print(filteredKrillIdData)
    
    # Create the Linear Model of the resulting sub data frame
    lm_Krill <- lm(filteredKrillIdData$oxygen ~ filteredKrillIdData$delta_t)
    
    # Calculate the residuals and cook stdev scores and layer them on as columns into the filtered dataframe
    df.lm.Krill <- fortify(lm_Krill, filteredKrillIdData) 
    #print(df.lm.Krill)
    
    # Filter out measurements that are outliers based on the cook stdev value
    df.lm.Krill <- df.lm.Krill[df.lm.Krill$.cooksd <= 4/(length(df.lm.Krill$KrillID)), ]
    #print(df.lm.Krill)
    
    # Merge the filtered data back into the dataframe to return
    filteredData[[filteredDataIndex]] <- df.lm.Krill
    filteredDataIndex <- filteredDataIndex + 1
  }
  
  # Combine the list of dataframes into a single dataframe and return it
  return(do.call(rbind, filteredData))
}

# stop here and go to next unique krill ID

T1dTotal.filtered <- KRILLLmSparkle(T1dTotal)
T2dTotal.filtered <- KRILLLmSparkle(T2dTotal)
T3dTotal.filtered <- KRILLLmSparkle(T3dTotal)
T4dTotal.filtered <- KRILLLmSparkle(T4dTotal)

par(mfrow = c(2,2))
plot(T1dTotal.filtered$delta_t, T1dTotal.filtered$oxygen)
title("Trial 01, Outliers Excluded")
plot(T2dTotal.filtered$delta_t, T2dTotal.filtered$oxygen)
title("Trial 01, Outliers Excluded")
plot(T3dTotal.filtered$delta_t, T3dTotal.filtered$oxygen)
title("Trial 01, Outliers Excluded")
plot(T4dTotal.filtered$delta_t, T4dTotal.filtered$oxygen)
title("Trial 01, Outliers Excluded")

```



###13.1a) Investigating Outliers by Trial- timeseries plots showing the four distinct dataframes
*Outliers Included*
```{r 13.1a Investigating Outliers by Trial- timeseries plot again!}

par(mfrow = c(2,2))
plot(T1dTotal$delta_t, T1dTotal$oxygen)
title("Trial 01, Outliers Included")
plot(T2dTotal$delta_t, T2dTotal$oxygen)
title("Trial 02, Outliers Included")
plot(T3dTotal$delta_t, T3dTotal$oxygen)
title("Trial 03, Outliers Included")
plot(T4dTotal$delta_t, T4dTotal$oxygen)
title("Trial 04, Outliers Included")

```


### 13.2) Review of Oxygen Per Vial Plots (now with outliers removed)

### 13.2a) Trial 1 Vial Oxygen over Time
```{r 13.2a) Trial 1 Vial Oxygen over Time}

# T1dTotal original 
# T1dTotal.filtered outliers removed 

ggplot(T1dTotal, aes(x = Time, y = percentDO, colour = KrillID)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial01 Vial Oxygen over Time, Original with Outliers") +
  geom_hline(yintercept = c(.8), colour = "red") +
  facet_wrap(~ Treatment) + 
  theme_bw()

```
### 13.2b) Trial 1 Vial Oxygen over Time
```{r 13.2b) Trial 1 Vial Oxygen over Time}

# T1dTotal original 
# T1dTotal.filtered outliers removed 

ggplot(T1dTotal.filtered, aes(x = Time, y = percentDO, colour = KrillID)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial01 Vial Oxygen over Time, Outliers Removed") +
  geom_hline(yintercept = c(.8), colour = "red") +
  facet_wrap(~ Treatment) + 
  theme_bw()

```
### 13.3a) Trial 2 Vial Oxygen over Time
```{r 13.3a) Trial 2 Vial Oxygen over Time}

# T2dTotal original 
# T2dTotal.filtered outliers removed 

ggplot(T2dTotal, aes(x = Time, y = percentDO, colour = KrillID)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial02 Vial Oxygen over Time, Original with Outliers") +
  geom_hline(yintercept = c(.8), colour = "red") +
  facet_wrap(~ Treatment) + 
  theme_bw()

```



### 13.3b) Trial 2 Vial Oxygen over Time
```{r 13.3b) Trial 2 Vial Oxygen over Time}

# T2dTotal original 
# T2dTotal.filtered outliers removed 

ggplot(T2dTotal.filtered, aes(x = Time, y = percentDO, colour = KrillID)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial02 Vial Oxygen over Time, Outliers Removed") +
  geom_hline(yintercept = c(.8), colour = "red") +
  facet_wrap(~ Treatment) + 
  theme_bw()

```



### 13.4a) Trial 3 Vial Oxygen over Time
```{r 13.4a) Trial 3 Vial Oxygen over Time}

# T3dTotal original 
# T3dTotal.filtered outliers removed 

ggplot(T3dTotal, aes(x = Time, y = percentDO, colour = KrillID)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial03 Vial Oxygen over Time, Original with Outliers") +
  geom_hline(yintercept = c(.8), colour = "red") +
  facet_wrap(~ Treatment) + 
  theme_bw()

```



### 13.4b) Trial 3 Vial Oxygen over Time
```{r 13.4b) Trial 3 Vial Oxygen over Time}

# T3dTotal original 
# T3dTotal.filtered outliers removed 

ggplot(T3dTotal.filtered, aes(x = Time, y = percentDO, colour = KrillID)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial03 Vial Oxygen over Time, Outliers Removed") +
  geom_hline(yintercept = c(.8), colour = "red") +
  facet_wrap(~ Treatment) + 
  theme_bw()

```



### 13.5a) Trial 4 Vial Oxygen over Time

**Question** I'm not missing blanks am I?
T4dTotal <- filter(dtotal, TrialID == "Trial04")
T4dTotal <- T4dTotal %>% filter(Treatment %in% c("CUR", "CHG", "TMP", "NA"))
**Question** Where are my blanks from trial 04?

```{r 13.5a) Trial 4 Vial Oxygen over Time}

# T4dTotal original 
# T4dTotal.filtered outliers removed 

ggplot(T4dTotal, aes(x = Time, y = percentDO, colour = KrillID)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial04 Vial Oxygen over Time, Original with Outliers") +
  geom_hline(yintercept = c(.8), colour = "red") +
  facet_wrap(~ Treatment) + 
  theme_bw()

```

```{r}

print(T4dTotal$Treatment)

```



### 13.5b) Trial 4 Vial Oxygen over Time
```{r 13.5b) Trial 4 Vial Oxygen over Time}

# T4dTotal original 
# T4dTotal.filtered outliers removed 

ggplot(T4dTotal.filtered, aes(x = Time, y = percentDO, colour = KrillID)) +
  geom_point(size = 1) +
  geom_smooth(method = "lm") +
  #scale_y_continuous(breaks=seq(250,950,by=50))   +
  ggtitle("Trial04 Vial Oxygen over Time, Outliers Removed") +
  geom_hline(yintercept = c(.8), colour = "red") +
  facet_wrap(~ Treatment) + 
  theme_bw()

```
### 13.6 Bringing together all outlier scrubbed DFs
```{r13.6 Bringing together all outlier scrubbed DFs}

#T1234dTotal.filtered <- rbind(T1dTotal.filtered,T2dTotal.filtered,T3dTotal.filtered,T4dTotal.filtered)


```



# 14.) Analysis, Respirometry - Correcting the Slope for Blanks
```{r 14.) Analysis, Respirometry - Correcting the Slope for Blanks}

#*********************************
## 14.) Analysis, Respirometry - Correcting the Slope for Blanks 
#*********************************

#blank corrected slope and blank-size corrected slope
## need to correct all slopes with the blanks' slope
## this is the background respiration of whatever phtyos and instrument drift
## create a mean blank slope per trial
## merge with the master(krill slopes) and "correct" all slopes against mean value (per trial)
# x is equal to the blank vials  

# #|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |

# Creating four seperate means from the blank vials per trial
x <- subset(dSlopes, dSlopes$MOATS == "blank")

xtrial1 <- subset(x, x$TrialID == "Trial01")
xtrial2 <- subset(x, x$TrialID == "Trial02")
xtrial3 <- subset(x, x$TrialID == "Trial03")
xtrial4 <- subset(x, x$TrialID == "Trial04")

blankmeanslope1 <- mean(xtrial1$slope)
blankmeanslope2 <- mean(xtrial2$slope)
blankmeanslope3 <- mean(xtrial3$slope)
blankmeanslope4 <- mean(xtrial4$slope)

# #|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |

#Creating new corrected varibles for slopes adjusted for blank vials and size of animal
dSlopes$CorrSlope <- ""
dSlopes$CorrSlope <- as.numeric(dSlopes$CorrSlope)
dSlopes$slope <- as.numeric(dSlopes$slope)

# #|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |
# Conditonal Statement directing certain means to their respective trials
# take absolute values not to add a negative nubmer

dSlopes <- dSlopes %>% mutate(CorrSlope=case_when(
    (dSlopes$MOATS == "blank" ~ dSlopes$slope),
    (dSlopes$TrialID == "Trial01" ~ dSlopes$slope-(abs(blankmeanslope1))),
    (dSlopes$TrialID == "Trial02" ~ dSlopes$slope-(abs(blankmeanslope2))),
    (dSlopes$TrialID == "Trial03" ~ dSlopes$slope-(abs(blankmeanslope3))),
    (dSlopes$TrialID == "Trial04" ~ dSlopes$slope-(abs(blankmeanslope4))),
    TRUE ~ as.numeric(0)
))
# #|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |
# Correcting for the size of the animal 
dSlopes$WetWeight <- as.numeric(dSlopes$WetWeight)
dSlopes$WetWeightSlope <- dSlopes$CorrSlope/dSlopes$WetWeight

#|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |


#create plots and perhaps convert to larger units

``` 



# xx.x What if I plotted some boxplots of corrected slope
```{r}

# 
# dSlopes1 <- dSlopes %>% filter(CorrSlope<=10) # %>%
#   
#   # filter(Treatment %in% c("current", "allchange", "hightemperature"))
# 
# 
# dSlopes2 <- dSlopes %>% filter(CorrSlope<=10) %>%
#             filter(Treatment %in% c("CUR", "CHG", "TMP"))
# 
# 
# ggplot(dSlopes2, aes(Treatment, CorrSlope)) +
#             geom_jitter(color = "grey") +
#             geom_boxplot(notch = TRUE, outlier.shape = NA, colour = "green") +
#             geom_point(data = dSlopes2, aes(x=Treatment, y=CorrSlope), size=1, color = "purple") + 
#             facet_wrap(~TrialID) +
#             ggtitle("All Treatments, All Trials, Corrected Slopes") +
#             theme_bw() 
# 



```

# XX.xx More terrible plots

```{r}

# ggplot(dSlopes2, aes(Treatment, CorrSlope)) +
#             # geom_jitter(color = "grey") +
#             geom_boxplot(notch = TRUE, outlier.shape = NA, colour = "green") +
#             geom_point(data = dSlopes2, aes(x=Treatment, y=CorrSlope), size=1, color = "purple") + 
#             ggtitle("All Treatments, All Trials, Corrected Slopes") +
#             theme_bw() 

```



## 99.a Summary Statistics on Corrected Slopes
```{r 99.a Summary Statistics on Corrected Slopes}

#*********************************
## 99a.) Analysis, Respirometry - Slopes already corrected for size (wet weight) & against blanks 
#*********************************

## Gives count, mean, standard deviation, standard error of the mean, and confidence interval (default 95%).
##   data: a data frame.
##   measurevar: the name of a column that contains the variable to be summariezed
##   groupvars: a vector containing names of columns that contain grouping variables
##   na.rm: a boolean that indicates whether to ignore NA's
##   conf.interval: the percent range of the confidence interval (default is 95%)
# summarySE <- function(data=NULL, measurevar, groupvars=NULL, na.rm=FALSE,
#                       conf.interval=.95, .drop=TRUE) {
#   library(plyr)
#   
#   # New version of length which can handle NA's: if na.rm==T, don't count them
#   length2 <- function (x, na.rm=FALSE) {
#     if (na.rm) sum(!is.na(x))
#     else       length(x)
#   }
#   
#   # This does the summary. For each group's data frame, return a vector with
#   # N, mean, and sd
#   datac <- ddply(data, groupvars, .drop=.drop,
#                  .fun = function(xx, col) {
#                    c(N    = length2(xx[[col]], na.rm=na.rm),
#                      mean = mean   (xx[[col]], na.rm=na.rm),
#                      sd   = sd     (xx[[col]], na.rm=na.rm)
#                    )
#                  },
#                  measurevar
#   )
#   
#   # Rename the "mean" column    
#   datac <- rename(datac, c("mean" = measurevar))
#   
#   datac$se <- datac$sd / sqrt(datac$N)  # Calculate standard error of the mean
#   
#   # Confidence interval multiplier for standard error
#   # Calculate t-statistic for confidence interval: 
#   # e.g., if conf.interval is .95, use .975 (above/below), and use df=N-1
#   ciMult <- qt(conf.interval/2 + .5, datac$N-1)
#   datac$ci <- datac$se * ciMult
#   
#   return(datac)
# } 
```


## 99.b.) Analysis, Respirometry - Saturation Calculations 
```{r 99.b.) Analysis, Respirometry - Saturation Calculations  }
 
#*********************************
# # 99.b.) Analysis, Respirometry - Saturation Calculations  
#*********************************
#saturation calculations!!!

# #add columns for temp in kelvin, add temps and salinity to dtotal version 5 #added 7/14: dont i want saturation in mastersheetr? why am i making dtotal5 so long when i could just keep mastersheetr the long one?
# 
# 
# #|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |
# 
# 
# 
# MasterSheetR$TempK <- MasterSheetR$Temp + 273.15
# #temps <- subset(MasterSheetR, select = c(KrillID, Temp, TempK, Salinity))
# #dtotal5 <- merge(temps, dtotal4, by="KrillID")
# #dtotal5$MeasurementID <- 1:nrow(dtotal5)
# #View(MasterSheetR)
# 
# #|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |
# 
# 
# 
# #calculate 100% saturation (mg/L)
# saturationfun <- function(Temp, Salinity, Pressure){
#   #Temp <- 12
#   TempK <- Temp +273.15
#   #Pressure = 1
#   a <- -139.34411
#   b <- 1.575701e+5
#   c <- 6.642308e+7
#   d <- 1.243800e+10
#   e <- 8.621949e+11
#   DOo <- exp(a + (b/TempK) - (c/TempK^2) + (d/TempK^3) - (e/TempK^4))
#   #Salinity <- 28.9
#   f <- 0.017674
#   g <- 10.754
#   h <- 2140.7
#   Fs <- exp(-Salinity * (f - g/TempK + h/TempK^2))
#   #Pressure <- 2
#   i <- 11.8571
#   j <- 3840.7
#   k <- 216961
#   u <- exp(i - j/TempK - k/TempK^2)
#   l <- 0.000975
#   m <- 1.43e-5
#   n <- 6.436e-8
#   theta <- l - m*Temp + n*Temp^2
#   Fp <- ((Pressure - u)*(1-theta*Pressure))/((1-u)*(1-theta))
#   totalDO <- Fp * DOo * Fs
#   return(totalDO)
# }
# 
# #|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |
# 
# 
# 
# #run saturation calcs on MasterSheetR
# #satDO
# MasterSheetR$solubility <- saturationfun(MasterSheetR$Temp, MasterSheetR$Salinity, MasterSheetR$patm/1000) 
# MasterSheetR$solubilityumol  <- solubility*31.2627 #that number is just the conversion factor from mg to umol for O2
# #View(MasterSheetR)
# 
# #|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |
# 
# 
# 
# #now make percent saturation column
# MasterSheetR$Value <- as.numeric(MasterSheetR$Value) #warning: NAs introduced by coercion
# MasterSheetR$percentsat <- (MasterSheetR$Value / MasterSheetR$solubilityumol)*100 
# MasterSheetR <- na.omit(MasterSheetR) #get rid of rows that have NA values(just my fault for messing up data collection)
# #View(MasterSheetR)
# 
# #|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |

```


## 99.c.) Analysis, Respirometry - Distribution Plot
```{r 99.c.) Analysis, Respirometry - Distribution Plot}

#*********************************
## 99.c.) Analysis, Respirometry - Distribution Plot  
#*********************************

# #plot for distribution of blanksizecorrslope as box an whisker
# mode(dtotal3$Temp)
# #View(dtotal3)
# babymaster <- data.frame(MasterSheetR$KrillID, MasterSheetR$Temp)
# babymaster <- babymaster[!duplicated(babymaster[,c("MasterSheetR.KrillID", "MasterSheetR.Temp")]),]
# babymaster$KrillID <- babymaster$MasterSheetR.KrillID
# #View(babymaster)
# dtotal3 <- merge(x=dtotal3, y=babymaster, by = "KrillID")
# dtotal3$Temp <- dtotal3$MasterSheetR.Temp
# #mode(dtotal3$KrillID)
# #str(dtotal3)
# dtotal4 <- subset(dtotal3, Treatment != "Blank")
# dtotal4$Temperature <- as.factor(dtotal4$MasterSheetR.Temp)
# 
# #|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |
# 
# 
# 
# #fix trials where i had the presens set to wrong temp
# dtotal4$Temperature[dtotal4$TrialID == "16JUN16_03"] <- 16
# dtotal4$Temperature[dtotal4$TrialID == "13JUL16_02"] <- 16
# dtotal4$Temperature[dtotal4$TrialID == "19JUN16_03"] <- 12
# View(dtotal4)
# 
# #|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |
# 
# 
# 
# ###make any changes to data = subset in any ways that you need to (take out trials that you messed up etc)
# dtotal4 <- subset(dtotal4, Size > 2.5)
# #dtotal4 <- subset(dtotal4, slope < 0) #can i do this?
# dtotal4 <- subset(dtotal4, TrialID != c("19JUN16_01"))
# dtotal4 <- subset(dtotal4, TrialID != c("22JUN16_03"))
# #dtotal4 <- subset(dtotal4, TrialID != c("13JUL16_06"))
# #dtotal4 <- subset(dtotal4, TrialID != c("23JUL16_01"))
# dtotal4 <- subset(dtotal4, MasterSheetR.KrillID != "13JUL16_06_9") #took off wrong crab??
# dtotal4 <- subset(dtotal4, MasterSheetR.KrillID != "07JUL16_04_1") #died in resp
# View(dtotal4)
# #fix respiration rates so they're how much oxygen USED instead of how much LEFT
# dtotal4$blanksizecorrslope <- dtotal4$blanksizecorrslope * (-1)
# summary(dtotal4$blanksizecorrslope)
# dtotal4$blankcorrslope <- dtotal4$blankcorrslope * (-1)
# 
# #|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |
```



## 99.D summaryForErrorBarsBSCS
```{r 99.D summaryForErrorBarsBSCS}
# summaryForErrorBarsBSCS <- summarySE(subset(dtotal4, blanksizecorrslope > 0), measurevar="blanksizecorrslope", 
#                                  groupvars=c("Treatment", "Temperature"), na.rm = TRUE)
# View(summaryForErrorBarsBSCS)
# 
# summaryForErrorBarsBCS <- summarySE(subset(dtotal4, blankcorrslope > 0), measurevar="blankcorrslope", 
#                                      groupvars=c( "Temperature"), na.rm = TRUE)
# View(summaryForErrorBarsBCS)
# 
# #|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |
# 
# 
# 
# #mean O2 consumption per crab at 12C
# # nmol/min/megalopae
# (oxyPerCrab12C <- mean(subset(dtotal4, Temperature == 12 & blankcorrslope > 0)$blankcorrslope))
# 
# #|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |

```


## 99.e Plott Yaayyyy with an ANOVA at the end
```{r 99.e Plott Yaayyyy}
# #PLOT YAYYY
# # blank corrected; remove resp rate < 0
# ggplot(subset(dtotal4, blanksizecorrslope > 0), aes(Treatment, blanksizecorrslope)) + 
#  # geom_boxplot(aes(colour = Temperature), lwd=1, position = position_dodge(.8)) +  #to split by treatment AND temp
#   geom_jitter(aes(colour = Temperature), position = position_jitterdodge(), alpha = 0.5) +
#   geom_errorbar(data = summaryForErrorBarsBSCS, aes(x = Treatment, colour = Temperature,
#                                                 ymin = blanksizecorrslope - se, ymax = blanksizecorrslope + se),
#                 position = position_dodge(0.8)) +
#   geom_point(data = summaryForErrorBarsBSCS, aes(x = Treatment, y = blanksizecorrslope, 
#                                              colour = Temperature), position = position_dodge(0.8), size = 5) +
#   labs( x = "Treatment", y = "Oxygen Consumption Rate\n(nmol/minute/mm of carapace length)") +
#   theme_bw(base_size = 16) +
#   guides(colour = guide_legend(override.aes = list(size=1))) +
#   #ylim(c(0,1.1)) + 
#   scale_x_discrete(labels = c("High pH\nHigh DO", "High pH\nLow DO", "Low pH\nHigh DO", "Low pH\nLow DO")) + 
#   scale_color_manual(values = c("blue", "red"), name= "Temperature",
#                      breaks = c("12", "16"),
#                      labels = c(expression("12"*~degree*C), expression("16"*~degree*C)))
# 
# 
# str(sizeslopesub)
# #size versus blank corrected respiration rate plot, separated by temperature
# sizeslopesub <- subset(dtotal4, Size != 0)
# #sizeslopesub <- subset(sizeslopesub, Temp == 12)#change to 16 to look at the graph for 16degreesC trials
# ggplot(subset(dtotal4, blanksizecorrslope > 0) , aes(x=Size, y=blanksizecorrslope)) +
#   geom_point(aes(colour = factor(Temp))) +
#   geom_smooth(data = subset(dtotal4, Temp == 12 & blanksizecorrslope > 0), method = lm, se = FALSE, aes(Size, blanksizecorrslope), colour = "blue") +
#   geom_smooth(data = subset(dtotal4, Temp == 16 & blanksizecorrslope > 0),method = lm, se = FALSE, aes(Size, blanksizecorrslope), colour = "red") +
#   labs(x = "Carapace length\n(mm)", y= "Oxygen Consumption Rate\n(nmol/minute/mm of carapace length)") +
#   theme_bw(base_size = 16) +
#   scale_color_manual(values = c("blue", "red"))
#   
# 
# summary(lmList(Size ~ blankcorrslope|Temp, sizeslopesub))$r.squared
# summary(lmList(Size ~ blankcorrslope|Temp, sizeslopesub))$adj.r.squared
# 
# ##################################
# #STATISTICAL ANALYSIS
# 
# #make a table comparing medians of each treatment by temp
# x <- as.matrix(summaryBy(blanksizecorrslope ~ Treatment + Temp, data = dtotal4, FUN = median))
# x <- as.list(x[,3])
# x <- matrix(x, nrow = 2, ncol = 4)
# colnames(x) <- c("HH", "HL", "LH", "LL")
# row.names(x) <- c("12C", "16C")
# View(x)
# 
# #ANOVA
# tapply(dtotal4$blanksizecorrslope, dtotal4$Temp, median)
# tapply(dtotal4$blanksizecorrslope, dtotal4$Treatment, median)
# int <- aov(data = dtotal4, blanksizecorrslope ~ Temp*Treatment)
# summary(int) #Pr(>F) column, temp:treatment row = p-value. if it's big we don't have to worry about interaction?
# 
# addint <- aov(data = dtotal4, blanksizecorrslope ~ Temp + Treatment)
# summary(addint) #p-value for temp is really small??? (1.91e-11)
# #omnibus test (F test) to look at main effects and interactions
# 
# 
# ano <- anova(lm(blanksizecorrslope ~ Treatment * Temp, subset(dtotal4, blanksizecorrslope > 0)))
# print (ano)
# summary(lm(blanksizecorrslope ~ Treatment * Temp, dtotal4))
# 
# pairwise.t.test(dtotal4$blanksizecorrslope, dtotal4$Treatment, p.adj = "none")
# pairwise.t.test(dtotal4$blanksizecorrslope, dtotal4$Temp, p.adj = "none")
# 
# #Tukey post hoc test
# TukeyHSD(aov(data = dtotal4, blanksizecorrslope ~ Treatment), conf.level = 0.95)
# #TukeyHSD(aov(data = dtotal4, blanksizecorrslope ~ Temp), conf.level = 0.95) #doesnt work
# 
# 
# #what am I doing here?

```



## x.x Junk code bits and comments from chapter 6
```{r}

# how to extract p value ... likely pulling it from the summary that the slope is greater than zero
# how likely if the krill held their breath for 2 hours....
# can't use the trial if krill went free diving in the vial


# slopes <- coef(info)[2]
# #print(slopes)
# dslopes <- data.matrix(slopes)
# #View(dref)
# mode(dslopes[,1])
# dslopes <- as.data.frame(dslopes)
# dslopes$slope <- dslopes$delta_t
# dslopes$delta_t <- NULL
# #View(dslopes)

#now for R^2!!

# Rsq <- sapply(dSlopes,function(x) summary(x)[[r.squared]])
# t(Rsq) #transposes rows and columns
# Rsq <- data.matrix(Rsq)
# #View(Rsq)
# KrillSlopes <- cbind(dSlopes, Rsq)
# View(KrilSlopes)

```



## X.X junk code from chapter 7
```{r junk code from chapter 7 corrected slopes}

# #2014 Paul comments/Direction 
# print(blankmeanslope)
# is.numeric(blankmeanslope)
# #now we have a mean of the blanks in each separate trial!
# #View(blankmeanslope)
# as.data.frame(blankmeanslope)
# #add a row that is the trial ID
# blankmeanslope <- cbind(blankmeanslope, levels(dtotal$TrialID))
# #View(blankmeanslope) #good so far!! 20 july
# blankmeanslope[,1] <- as.numeric(blankmeanslope[,1]) #make sure it stays numeric

#|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |

#  # # T/S this section ... I don't think we need this anymore

# # alread have trial ID 
# #rename column 2 as TrialID so it matches up with the column in dtotal2
# colnames(blankmeanslope)[2] <- "TrialID"
# #View(blankmeanslope)
# dtotalslope <- merge(dtotal2, blankmeanslope, by="TrialID")
# #View(dtotal3) #all still good 20 july
# dtotal3$blankmeanslope <- as.numeric(as.character(dtotal3$blankmeanslope))

#|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |

#  # # T/S this section ... I don't think we need this anymore
# # still working off dtotal 3
# dtotal3$slope <- as.numeric(dtotal3$slope)
# 
# #20 july: the blanks themselves are an issue because they're getting the average of themselves and the other blanks taken away from them. what do? 
# dtotal3$blankcorrslope <- (dtotal3$slope - dtotal3$blankmeanslope)
# #View(dtotal3)

#|- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |



####blank and size corrected slope


# dSlopes$CorrSlope <- ((subset(dSlopes$slope, dSlopes$TrialID == "Trial01"& dSlopes$MOATS != "blank"))/blankmeanslope1) |
# ((subset(dSlopes$slope, dSlopes$TrialID == "Trial02" & dSlopes$MOATS != "blank"))/blankmeanslope2) |
# ((subset(dSlopes$slope, dSlopes$TrialID == "Trial03" & dSlopes$MOATS != "blank"))/blankmeanslope3) | 
# ((subset(dSlopes$slope, dSlopes$TrialID == "Trial04" & dSlopes$MOATS != "blank"))/blankmeanslope4) 

# Trial01corslope <- subset(dSlopes$slope, dSlopes$TrialID == "Trial01"& dSlopes$MOATS != "blank")/blankmeanslope1 
# Trial02corslope <- subset(dSlopes$slope, dSlopes$TrialID == "Trial02"& dSlopes$MOATS != "blank")/blankmeanslope2 
# Trial03corslope <- subset(dSlopes$slope, dSlopes$TrialID == "Trial02"& dSlopes$MOATS != "blank")/blankmeanslope3
# Trial04corslope <- subset(dSlopes$slope, dSlopes$TrialID == "Trial02"& dSlopes$MOATS != "blank")/blankmeanslope4
#dSlopes$CorrSlope <- trial01corslope case_when(dSlopes$TrialID == "Trial01"& dSlopes$MOATS != "blank")



# dtotal3$blanksizecorrslope <- dtotal3$blankcorrslope/dtotal3$Size
# #View(dtotal3)
# mode(dtotal3$blanksizecorrslope)
# #y <- subset(dtotal3, dtotal3$blanksizecorrslope != "lnf")
# #View(y)#dealing with the blank vials' size being zero
# #View(dtotal3)
# View(dtotal3)



```









```{r}
#**************E*N*D*************# 
#*********************************
## END OF SCRIPT | END OF DOCUMENT 
#*********************************
```


## END OF SCRIPT | END OF DOCUMENT


